<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Confirmar Pedido</title>
</head>
<body>
<h1>Confirmar Pedido</h1>

<div th:if="${error != null}">
  <p style="color: red;" th:text="${error}"></p>
</div>

<div th:if="${cliente != null}">
  <h2>Datos del Cliente</h2>
  <p>Nombre: <span th:text="${cliente.nombre}"></span></p>
  <p>Apellidos: <span th:text="${cliente.apellidos}"></span></p>
</div>
<div th:unless="${cliente != null}">
  <p style="color: red;">Error: No se encontró información del cliente.</p>
</div>

<div th:if="${itemsPedido != null and not #lists.isEmpty(itemsPedido)}">
  <h2>Detalles del Pedido</h2>
  <ul>
    <li th:each="item : ${itemsPedido}">
      <span th:text="${item.nombre} + ' - €' + ${item.precio} + ' (Cantidad: ' + ${carrito[item.id] != null ? carrito[item.id] : 0} + ')'"></span>
    </li>
  </ul>
  <p>Total: <span th:text="'€' + ${total}"></span></p>
</div>
<div th:unless="${itemsPedido != null and not #lists.isEmpty(itemsPedido)}">
  <p style="color: red;">Error: No hay ítems en el pedido.</p>
</div>

<div th:if="${direccion != null}">
  <h2>Dirección de Envío</h2>
  <p th:text="${direccion.calle + ', ' + direccion.numero + ', ' + direccion.municipio + ', ' + direccion.codigoPostal}"></p>
</div>
<div th:unless="${direccion != null}">
  <p style="color: red;">Error: No se seleccionó una dirección de envío.</p>
</div>

<div th:if="${metodoPago != null}">
  <h2>Método de Pago</h2>
  <p th:text="${metodoPago}"></p>
</div>
<div th:unless="${metodoPago != null}">
  <p style="color: red;">Error: No se seleccionó un método de pago.</p>
</div>

<form th:action="@{/pedido/finalizar}" method="post" id="formConfirmarPedido">
  <input type="hidden" name="pedidoId" th:value="${pedido?.id}"/>
  <input type="hidden" name="direccionId" th:value="${direccion?.id}"/>
  <input type="hidden" name="metodoPago" th:value="${metodoPago}"/>
  <button type="submit" th:disabled="${pedido == null or itemsPedido == null or total == null or direccion == null or metodoPago == null}">Confirmar Pedido</button>
</form>

<a th:href="@{/verMenus(restauranteId=${pedido?.restaurante?.idUsuario})}">Volver a Menús</a>

<script>
  document.getElementById("formConfirmarPedido").addEventListener("submit", function (event) {
    const direccionId = document.querySelector("input[name='direccionId']").value;
    const metodoPago = document.querySelector("input[name='metodoPago']").value;
    if (!direccionId) {
      alert("Por favor, selecciona una dirección de envío en la página anterior.");
      event.preventDefault();
    }
    if (!metodoPago) {
      alert("Por favor, selecciona un método de pago en la página anterior.");
      event.preventDefault();
    }
  });
</script>
</body>
</html>